---
description: Provides a discovery mechanism for metadata for names resolved via EIP-3668
contributors:
  - jefflau
  - matoken.eth
ensip:
  status: draft
  created: 2022-09-22
  updated: 2025-10-06
ignoredRules: ["heading:implementation", "heading:open-items"]
---

# ENSIP-16: Metadata Event Discovery

## Abstract

This ENSIP specifies APIs for querying metadata directly on the resolver for EIP-3668 (CCIP Read: Secure offchain data retrieval) enabled names. EIP-3668 will power many domains in the future, however since the retrieval mechanism uses wildcard + offchain resolver, there is no standardised way to retrieve important metadata information such as which L2/offchain database the records are stored on and where JSON RPC endpoint is to find event log information.

## Motivation

With EIP-3668 subdomains already starting to see wide adoption, it is important that there is a standardised way for different stakeholders to discover and access metadata about offchain names.

This ENSIP allows Third-party indexing services to listen to the `MetadataChanged` event to automatically discover which chain and smart contract address will emit metadata events. This allows indexers to dynamically discover new data sources and begin indexing the event without relying on centralised rpc endpoint repositories, enabling comprehensive coverage of the ENS ecosystem.

## Specification

Resolver implements the following Solidity interface:

```solidity
// To be included in
// https://github.com/ensdomains/ens-contracts/blob/staging/contracts/resolvers/Resolver.sol
interface IOffchainResolverMetadataProvider {

    /**
     * @dev Returns metadata for discovering the location of offchain name data
     * @param name DNS-encoded name to query
     * @return rpcURLs The JSON RPC endpoint for querying offchain data. It can be "" if not needed
     * @return chainId The chain ID where the data is stored (optional)
     * @return baseRegistry The base registry address on the target chain that emits events.
     */
    function metadata(bytes calldata name)
        external
        view
        returns (
            string[] memory rpcURLs,
            uint256 chainId,
            address baseRegistry
        );

    event MetadataChanged(
        bytes name,              // DNS-encoded name
        string[] rpcURLs,        // JSON RPC endpoint
        uint256 chainId,         // Chain identifier (optional)
        address baseRegistry     // Base registry address
    );
}
```

**Requirements:**
- `chainId` must be provided. If the chain ID is for a non-EVM or off-chain system, certain values of chain ID will be reserved to indicate them. When such an ID is encountered, the RPC URL can point to a custom API format yet to be determined. For EVM-compatible chains, `chainId` SHOULD match the chain's EIP-155 identifier
- `rpcUrl` is optional. 
- `baseRegistry` is optional. If this address is specified, events will be emitted for indexers to digest.

### metadata function

The metadata function allows resolvers to dynamically provide information about where offchain data for a given name can be queried. This function returns the same information as would be emitted in a MetadataChanged event: the JSON RPC endpoint URLs, the chain ID where the data resides, and the base registry address on the target chain.

### MetadataChanged Event

The MetadataChanged event allows resolvers to signal where offchain metadata can be queried. When the data is stored on other EVM compatible chains, it can specify chain id and its base registry address so that indexers can dynamically discover the new source and start indexing.

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).