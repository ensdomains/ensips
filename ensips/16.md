---
description: Allows metadata to provide events on EIP-3668 enabled names
contributors:
  - jefflau
  - matoken.eth
ensip:
  status: draft
  created: 2022-09-22
  updated: 2025-08-04
ignoredRules: ["heading:implementation", "heading:open-items"]
---

# ENSIP-16: Metadata Event Discovery

## Abstract

This ENSIP specifies APIs for querying metadata directly on the resolver for EIP-3668 (CCIP Read: Secure offchain data retrieval) enabled names. EIP-3668 will power many of the domains in the future, however since the retrieval mechanism uses wildcard + offchain resolver, there is no standardised way to retrieve important metadata information such as which L2/offchain database the records are stored on and where JSON RPC endpoint is to find event log information.

## Motivation

With EIP-3668 subdomains already starting to see wide adoption, it is important that there is a standardised way for different stakeholders to discover and access metadata about offchain names.

This ENSIP addresses three critical use cases:

**Data Indexers**: Third-party indexing services can use the `MetadataChanged` event to automatically discover which chain and smart contract address will emit metadata events. This allows indexers to dynamically discover new data sources and begin indexing them without manual configuration, enabling comprehensive coverage of the ENS ecosystem.

**Name Owners with Custom Storage**: For name owners who store records in traditional databases (RDBMS) or non-EVM compatible chains, this ENSIP provides a way to expose metadata with a common JSON RPC interface. 

This allows these systems to present metadata in the same format as EVM-based event logs, allowing data indexers to index non-EVM compatible name storages.

## Specification

Resolver implments the following Solidity interface:

```solidity
// To be included in
// https://github.com/ensdomains/ens-contracts/blob/staging/contracts/resolvers/Resolver.sol
interface IOffchainResolverMetadataProvider {

    /**
     * @dev Returns metadata for discovering the location of offchain name data
     * @param name DNS-encoded name to query
     * @return rpcURLs The JSON RPC endpoint for querying offchain data
     * @return chainId The chain ID where the data is stored (optional)
     * @return baseRegistry The base registry address on the target chain that emit events.
     */
    function metadata(bytes calldata name)
        external
        view
        returns (
            string[] memory rpcURLs,
            uint256 chainId,
            address baseRegistry
        );

    event MetadataChanged(
        bytes name,              // DNS-encoded name
        string[] rpcURLs,        // JSON RPC endpoint
        uint256 chainId,         // Chain identifier (optional)
        address baseRegistry     // Base registry address
    );
}
```

### metadata function

The metadata function allows resolvers to dynamically provide information about where offchain data for a given name can be queried. This function returns the same information as would be emitted in a MetadataChanged event: the GraphQL endpoint URL, the chain ID where the data resides (0 for non-EVM sources), and the root registry address on the target chain. This enables clients to discover and connect to the appropriate data source for any given name. 

### MetadataChanged Event

The MetadataChanged event allows resolvers to signal where offchain metadata can be queried. When the data is stored on other EVM compatible chains, it can specify chain id and its root registry address so that indexers can dynamically discover the new source and start indexing.

### JSON RPC Events

JSON RPC endoint must implement the following Solidity events following [EIP-1474 eth_getLogs](https://eips.ethereum.org/EIPS/eip-1474#eth_getlogs) format.

These events are extracted from [ENS v2 smart contract events](https://github.com/ensdomains/namechain)

#### Registry Events

```solidity
// Emitted when a new subname is registered
event NewSubname(bytes32 indexed tokenId, string label);

// Standard ERC1155 transfer event for name ownership changes
event TransferSingle(
    address indexed operator,
    address indexed from,
    address indexed to,
    uint256 id,
    uint256 value // must always be 1
);

// Standard ERC1155 transfer event for multiple name ownership changes
event TransferBatch(
  address indexed operator,
  address indexed from,
  address indexed to,
  uint256[] ids,
  uint256[] values
);

// Standard ERC721 transfer event for name ownership changes
event Transfer(
  address indexed from,
  address indexed to,
  uint256 tokenId
);

// Emitted when subregistry is updated
event SubregistryUpdate(
    uint256 indexed id,
    address subregistry,
    uint64 expiry
);

// Emitted when resolver is updated
event ResolverUpdate(
    uint256 indexed id,
    address resolver
);
```

NOTE: The registry contract supports either ERC721 (Transfer) or ERC1155 (TransferSingle, TransferBatch), but not both at the same time.

#### Resolver Events

```solidity
event AddressChanged(
    bytes32 indexed node,
    uint256 coinType,
    bytes newAddress
);

event AddrChanged(
  bytes32 indexed node,
  address a
);

event TextChanged(
    bytes32 indexed node,
    string indexed indexedKey,
    string key,
    string value
);

event ContenthashChanged(
  bytes32 indexed node,
  bytes hash
);
```

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).