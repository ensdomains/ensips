---
description: Allows metadata to be queried on EIP-3668 enabled names
contributors:
  - jefflau
  - matoken.eth
ensip:
  status: draft
  created: 2022-09-22
  updated: 2025-08-04
ignoredRules: ["heading:implementation", "heading:open-items"]
---

# ENSIP-16: Offchain Metadata

## Abstract

This ENSIP specifies APIs for querying metadata directly on the resolver for EIP-3668 (CCIP Read: Secure offchain data retrieval) enabled names. EIP-3668 will power many of the domains in the future, however since the retrieval mechanism uses wildcard + offchain resolver, there is no standardised way to retrieve important metadata information such as the owner (who can change the records), or which L2/offchain database the records are stored on.

## Motivation

With EIP-3668 subdomains already starting to see wide adoption, it is important that there is a way for frontend interfaces to get important metadata to allow a smooth user experience. For instance a UI needs to be able to check if the currently connected user has the right to update an EIP-3668 name.

This ENSIP addresses this by adding a way of important metadata to be gathered on the offchain resolver, which would likely revert and be also resolved offchain, however there is an option for it to be also left onchain if there value was static and wouldn't need to be changed often.

## Specification

### MetadataChanged Event

The MetadataChanged event allows resolvers to signal where offchain metadata can be queried. When the data is stored on other EVM compatible chains, it can specify chain id and its root registry address so that indexers can dynamically discover the new source and start indexing.

```solidity
// Emitted when resolver metadata points to offchain data source
event MetadataChanged(
    bytes name,              // DNS-encoded name
    string graphqlUrl,       // GraphQL endpoint for offchain data
    uint256 chainId,         // Chain identifier (0 for non-EVM sources)
    address l2RegistryAddress // Root registry address on target chain
);
```

### GraphQL Schema

[GraphQL](https://graphql.org) is a query language for APIs and a runtime for fulfilling those queries with onchain event data. You can use the hosted/decentralised indexing service such as [The Graph](https://thegraph.com), [Goldsky](https://docs.goldsky.com/introduction), [QuickNode](https://marketplace.quicknode.com/add-on/subgraph-hosting) or host your own using The Graph, or [ponder](https://ponder.sh)

#### L1

The following schema should be implemented by indexers to track MetadataChanged events:

```graphql
type Domain @entity {
  id
  metadata: Metadata
}

type Metadata @entity {
  "L1 resolver address"
  id: ID!
  "DNS encoded name"
  name: String
  "URL of the GraphQL endpoint"
  graphqlUrl: String
  "Chain identifier (0 for non-EVM sources)"
  chainId: BigInt
  "Root registry address on target chain"
  l2RegistryAddress: Bytes
}
```

For the schema of the actual offchain data that the GraphQL endpoint should serve, implementers may define their own schema based on their specific needs. For L2 implementations with indexable events, see ENSIP-X which defines standard events and schemas.


#### L2

L2 graphql URL is discoverable via `metadata` function `graphqlUrl` field.
Because the canonical ownership of the name exists on L1, some L2/offchain storage may choose to allow multiple entities to update the same node namespaced by `context`. When querying the domain data, the query should be filtered by `context` that is returned by `metadata`function `context` field

```graphql
type Domain {
  id: ID! # concatenation of context and namehash delimited by `-`
  context: Bytes
  name: String
  namehash: Bytes
  labelName: String
  labelhash: Bytes
  resolvedAddress: Bytes
  parent: Domain
  subdomains: [Domain]
  subdomainCount: Int!
  resolver: Resolver!
  expiryDate: BigInt
}

type Resolver @entity {
  id: ID! # concatenation of node, resolver address and context delimited by `-`
  node: Bytes
  context: Bytes
  address: Bytes
  domain: Domain
  addr: Bytes
  contentHash: Bytes
  texts: [String!]
  coinTypes: [BigInt!]
}
```

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
